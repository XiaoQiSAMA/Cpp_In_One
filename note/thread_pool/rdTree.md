# 红黑树的使用场景

$\color{red}{sk\_buff结构体中有一个红黑树}$

## 在网络传输过程中，面对高并发传输

客户端 --> data --> 物理网卡 --> Linuxn内核{nic解析 << sk_buff数据包(加入队列) >> 协议栈} --> 应用程序

> 当多台主机传输数据到服务端网卡时，在物理网卡到协议栈的sk_buff数据包在队列中排序，同一台发送数据的客户端会由于队列排序间隔问题，使得连续发送的数据产生回复间隔。
>  
> 此时，可以利用红黑树将同一主机发送的数据构建成同一个分支下，避免间隔回复。

## epoll底层红黑树实现

![epoll](epoll_rdTree.png)

> 当sk_buff输入进rmem中，经过sock转成fd进行通信，再将返回的信息写入wmem中经过tcp_output.c添加网络报头构建成sk_buff传输出去。
>
> 这一过程中sk_buff的来源ip和目的ip可以经过红黑树进行统一管理。

## 内存块红黑树组织

堆内存管理时产生内存碎片

> 引入红黑树来构建(k, v)->(start, block)，这样在free的时候只需要去找到start的指针，就可以自动释放指定的内存块。
